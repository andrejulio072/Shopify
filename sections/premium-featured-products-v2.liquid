<!--
========================================
ðŸš€ PREMIUM FEATURED PRODUCTS V2.0
International Standards | Advanced Features
Inspired by: Gymshark, MyProtein, Alphalete
========================================
-->

<link rel="stylesheet" href="{{ 'premium-v2.css' | asset_url }}">

<style>
  .premium-featured-v2 {
    padding: var(--space-20) 0;
    background: linear-gradient(135deg, var(--color-white) 0%, var(--color-gray-50) 100%);
    position: relative;
    overflow: hidden;
  }

  .featured-header {
    text-align: center;
    margin-bottom: var(--space-16);
  }

  .section-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-2) var(--space-4);
    background: linear-gradient(135deg, var(--color-electric-blue) 0%, var(--color-neon-green) 100%);
    border-radius: var(--radius-full);
    color: var(--color-white);
    font-size: var(--text-sm);
    font-weight: var(--font-semibold);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: var(--space-6);
    animation: slide-up 0.8s ease-out;
  }

  .section-title {
    font-size: clamp(var(--text-3xl), 5vw, var(--text-5xl));
    font-weight: var(--font-black);
    color: var(--color-black);
    margin-bottom: var(--space-4);
    text-transform: uppercase;
    letter-spacing: -0.02em;
    animation: slide-up 0.8s ease-out 0.2s both;
  }

  .section-subtitle {
    font-size: var(--text-lg);
    color: var(--color-gray-600);
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
    animation: slide-up 0.8s ease-out 0.4s both;
  }

  /* FILTER TABS */
  .filter-tabs {
    display: flex;
    justify-content: center;
    gap: var(--space-4);
    margin-bottom: var(--space-12);
    flex-wrap: wrap;
  }

  .filter-tab {
    background: transparent;
    border: 2px solid var(--color-gray-300);
    color: var(--color-gray-600);
    padding: var(--space-3) var(--space-6);
    border-radius: var(--radius-xl);
    font-size: var(--text-sm);
    font-weight: var(--font-semibold);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    cursor: pointer;
    transition: var(--transition-normal);
  }

  .filter-tab.active {
    background: linear-gradient(135deg, var(--color-electric-blue) 0%, var(--color-neon-green) 100%);
    border-color: transparent;
    color: var(--color-white);
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .filter-tab:hover:not(.active) {
    border-color: var(--color-electric-blue);
    color: var(--color-electric-blue);
    transform: translateY(-1px);
  }

  /* PRODUCTS GRID */
  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--space-6);
    margin-bottom: var(--space-12);
  }

  .product-card {
    background: var(--color-white);
    border-radius: var(--radius-2xl);
    overflow: hidden;
    box-shadow: var(--shadow-md);
    transition: var(--transition-normal);
    cursor: pointer;
    position: relative;
    animation: fade-in 0.8s ease-out;
  }

  .product-card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-2xl);
  }

  .product-image-container {
    position: relative;
    width: 100%;
    height: 280px;
    overflow: hidden;
  }

  .product-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: var(--transition-slow);
  }

  .product-card:hover .product-image {
    transform: scale(1.05);
  }

  .product-badges {
    position: absolute;
    top: var(--space-4);
    left: var(--space-4);
    z-index: 2;
    display: flex;
    gap: var(--space-2);
  }

  .product-badge {
    background: linear-gradient(135deg, var(--color-neon-green) 0%, #28B946 100%);
    color: var(--color-white);
    padding: var(--space-1) var(--space-3);
    border-radius: var(--radius-full);
    font-size: var(--text-xs);
    font-weight: var(--font-bold);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .product-badge.sale {
    background: linear-gradient(135deg, var(--color-error-red) 0%, #CC1B1B 100%);
  }

  .product-badge.bestseller {
    background: linear-gradient(135deg, var(--color-warning-orange) 0%, #E6820A 100%);
  }

  .product-quick-actions {
    position: absolute;
    top: var(--space-4);
    right: var(--space-4);
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    opacity: 0;
    transition: var(--transition-normal);
  }

  .product-card:hover .product-quick-actions {
    opacity: 1;
  }

  .quick-action-btn {
    background: rgba(255, 255, 255, 0.9);
    border: none;
    border-radius: var(--radius-lg);
    padding: var(--space-3);
    color: var(--color-gray-700);
    cursor: pointer;
    transition: var(--transition-normal);
    backdrop-filter: blur(10px);
  }

  .quick-action-btn:hover {
    background: var(--color-white);
    color: var(--color-electric-blue);
    transform: scale(1.1);
  }

  .product-content {
    padding: var(--space-6);
  }

  .product-category {
    font-size: var(--text-xs);
    color: var(--color-gray-500);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: var(--space-2);
    font-weight: var(--font-semibold);
  }

  .product-title {
    font-size: var(--text-lg);
    font-weight: var(--font-bold);
    color: var(--color-black);
    margin-bottom: var(--space-3);
    line-height: 1.3;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .product-card:hover .product-title {
    color: var(--color-electric-blue);
  }

  .product-rating {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    margin-bottom: var(--space-3);
  }

  .star-rating {
    display: flex;
    gap: var(--space-1);
  }

  .star {
    color: var(--color-warning-orange);
    font-size: var(--text-sm);
  }

  .star.empty {
    color: var(--color-gray-300);
  }

  .rating-text {
    font-size: var(--text-sm);
    color: var(--color-gray-500);
  }

  .product-price {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    margin-bottom: var(--space-4);
  }

  .current-price {
    font-size: var(--text-xl);
    font-weight: var(--font-black);
    color: var(--color-electric-blue);
  }

  .original-price {
    font-size: var(--text-base);
    color: var(--color-gray-500);
    text-decoration: line-through;
  }

  .discount-percent {
    background: var(--color-error-red);
    color: var(--color-white);
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
    font-size: var(--text-xs);
    font-weight: var(--font-bold);
  }

  .product-actions {
    display: flex;
    gap: var(--space-3);
  }

  .add-to-cart-btn {
    flex: 1;
    background: linear-gradient(135deg, var(--color-electric-blue) 0%, #0056CC 100%);
    color: var(--color-white);
    border: none;
    padding: var(--space-3) var(--space-4);
    border-radius: var(--radius-lg);
    font-size: var(--text-sm);
    font-weight: var(--font-semibold);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    cursor: pointer;
    transition: var(--transition-normal);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
  }

  .add-to-cart-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .wishlist-btn {
    background: transparent;
    border: 2px solid var(--color-gray-300);
    color: var(--color-gray-600);
    padding: var(--space-3);
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: var(--transition-normal);
  }

  .wishlist-btn:hover,
  .wishlist-btn.active {
    border-color: var(--color-error-red);
    color: var(--color-error-red);
  }

  /* LOAD MORE SECTION */
  .load-more-section {
    text-align: center;
    margin-top: var(--space-16);
  }

  .load-more-btn {
    background: transparent;
    border: 2px solid var(--color-electric-blue);
    color: var(--color-electric-blue);
    padding: var(--space-4) var(--space-8);
    border-radius: var(--radius-xl);
    font-size: var(--text-base);
    font-weight: var(--font-semibold);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    cursor: pointer;
    transition: var(--transition-normal);
    display: inline-flex;
    align-items: center;
    gap: var(--space-3);
  }

  .load-more-btn:hover {
    background: var(--color-electric-blue);
    color: var(--color-white);
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(0, 122, 255, 0.3);
  }

  /* RESPONSIVE */
  @media (min-width: 768px) {
    .products-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .products-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (min-width: 1280px) {
    .products-grid {
      grid-template-columns: repeat(4, 1fr);
    }
  }

  /* LOADING STATES */
  .loading {
    opacity: 0.6;
    pointer-events: none;
  }

  .skeleton {
    background: linear-gradient(90deg, var(--color-gray-200) 25%, var(--color-gray-100) 50%, var(--color-gray-200) 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
  }

  @keyframes loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }
</style>

<section class="premium-featured-v2">
  <div class="container container-premium">
    <!-- Section Header -->
    <div class="featured-header">
      {% if section.settings.section_badge %}
        <div class="section-badge">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2l3.09 6.26L22 9l-5 4.87 1.18 6.88L12 17.77l-6.18 2.98L7 14.87 2 9l6.91-1.74L12 2z"/>
          </svg>
          {{ section.settings.section_badge }}
        </div>
      {% endif %}

      <h2 class="section-title">{{ section.settings.section_title | default: "FEATURED PRODUCTS" }}</h2>

      {% if section.settings.section_subtitle %}
        <p class="section-subtitle">{{ section.settings.section_subtitle }}</p>
      {% endif %}
    </div>

    <!-- Filter Tabs -->
    {% if section.settings.show_filters %}
      <div class="filter-tabs">
        <button class="filter-tab active" data-filter="all">ALL PRODUCTS</button>
        <button class="filter-tab" data-filter="bestsellers">BESTSELLERS</button>
        <button class="filter-tab" data-filter="new">NEW ARRIVALS</button>
        <button class="filter-tab" data-filter="sale">ON SALE</button>
      </div>
    {% endif %}

    <!-- Products Grid -->
    <div class="products-grid" id="productsGrid">
      {% assign collection = collections[section.settings.collection] %}
      {% if collection == empty %}
        {% assign collection = collections.all %}
      {% endif %}

      {% for product in collection.products limit: section.settings.products_to_show %}
        <div class="product-card" data-product-tags="{{ product.tags | join: ',' | downcase }}">
          <div class="product-image-container">
            <!-- Product Image -->
            {% if product.images.size > 0 %}
              <img
                src="{{ product.featured_image | image_url: width: 400 }}"
                alt="{{ product.title }}"
                width="400"
                height="400"
                class="product-image"
                loading="lazy"
              >
            {% else %}
              <div class="product-image skeleton"></div>
            {% endif %}

            <!-- Product Badges -->
            <div class="product-badges">
              {% if product.compare_at_price > product.price %}
                <span class="product-badge sale">SALE</span>
              {% endif %}
              {% if product.tags contains 'new' %}
                <span class="product-badge">NEW</span>
              {% endif %}
              {% if product.tags contains 'bestseller' %}
                <span class="product-badge bestseller">BESTSELLER</span>
              {% endif %}
            </div>

            <!-- Quick Actions -->
            <div class="product-quick-actions">
              <button class="quick-action-btn" title="Quick View" onclick="openQuickView('{{ product.handle }}')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
              </button>
              <button class="quick-action-btn wishlist-btn" title="Add to Wishlist" onclick="toggleWishlist(this, '{{ product.id }}')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                </svg>
              </button>
            </div>
          </div>

          <div class="product-content">
            <!-- Product Category -->
            {% if product.type != blank %}
              <div class="product-category">{{ product.type }}</div>
            {% endif %}

            <!-- Product Title -->
            <h3 class="product-title">
              <a href="{{ product.url }}">{{ product.title }}</a>
            </h3>

            <!-- Product Rating -->
            <div class="product-rating">
              <div class="star-rating">
                {% for i in (1..5) %}
                  <span class="star">â˜…</span>
                {% endfor %}
              </div>
              <span class="rating-text">({{ product.metafields.reviews.rating_count | default: 0 }} reviews)</span>
            </div>

            <!-- Product Price -->
            <div class="product-price">
              <span class="current-price">{{ product.price | money }}</span>
              {% if product.compare_at_price > product.price %}
                <span class="original-price">{{ product.compare_at_price | money }}</span>
                <span class="discount-percent">
                  -{{ product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price }}%
                </span>
              {% endif %}
            </div>

            <!-- Product Actions -->
            <div class="product-actions">
              <button class="add-to-cart-btn" onclick="addToCart('{{ product.variants.first.id }}', this)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 22a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
                  <path d="M20 22a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
                  <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                </svg>
                ADD TO CART
              </button>
              <button class="wishlist-btn" onclick="toggleWishlist(this, '{{ product.id }}')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- Load More Section -->
    {% if section.settings.show_load_more and collection.products.size > section.settings.products_to_show %}
      <div class="load-more-section">
        <button class="load-more-btn" onclick="loadMoreProducts()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M8 12l2 2 4-4"/>
          </svg>
          LOAD MORE PRODUCTS
        </button>
      </div>
    {% endif %}
  </div>
</section>

<script>
  // Filter functionality
  document.querySelectorAll('.filter-tab').forEach(tab => {
    tab.addEventListener('click', function() {
      // Update active tab
      document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
      this.classList.add('active');

      // Filter products
      const filter = this.getAttribute('data-filter');
      filterProducts(filter);
    });
  });

  function filterProducts(filter) {
    const products = document.querySelectorAll('.product-card');

    products.forEach(product => {
      const tags = product.getAttribute('data-product-tags');
      let show = true;

      if (filter === 'bestsellers') {
        show = tags.includes('bestseller');
      } else if (filter === 'new') {
        show = tags.includes('new');
      } else if (filter === 'sale') {
        show = product.querySelector('.product-badge.sale') !== null;
      }

      if (show || filter === 'all') {
        product.style.display = 'block';
        product.style.animation = 'fade-in 0.5s ease-out';
      } else {
        product.style.display = 'none';
      }
    });
  }

  // Add to cart functionality
  function addToCart(variantId, button) {
    button.classList.add('loading');
    button.innerHTML = 'ADDING...';

    fetch('/cart/add.js', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        items: [{
          id: variantId,
          quantity: 1
        }]
      })
    })
    .then(response => response.json())
    .then(data => {
      button.classList.remove('loading');
      button.innerHTML = 'âœ“ ADDED';
      button.style.background = 'var(--color-neon-green)';

      // Reset button after 2 seconds
      setTimeout(() => {
        button.innerHTML = `
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 22a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
            <path d="M20 22a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
          </svg>
          ADD TO CART
        `;
        button.style.background = '';
      }, 2000);

      // Update cart count if exists
      const cartCount = document.querySelector('.cart-count');
      if (cartCount) {
        cartCount.textContent = parseInt(cartCount.textContent) + 1;
      }
    })
    .catch(error => {
      button.classList.remove('loading');
      button.innerHTML = 'ERROR';
      console.error('Error adding to cart:', error);
    });
  }

  // Wishlist functionality
  function toggleWishlist(button, productId) {
    button.classList.toggle('active');

    if (button.classList.contains('active')) {
      button.querySelector('svg').style.fill = 'currentColor';
    } else {
      button.querySelector('svg').style.fill = 'none';
    }

    // Store wishlist in localStorage
    let wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');

    if (button.classList.contains('active')) {
      if (!wishlist.includes(productId)) {
        wishlist.push(productId);
      }
    } else {
      wishlist = wishlist.filter(id => id !== productId);
    }

    localStorage.setItem('wishlist', JSON.stringify(wishlist));
  }

  // Load wishlist state on page load
  document.addEventListener('DOMContentLoaded', function() {
    const wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');

    document.querySelectorAll('.wishlist-btn').forEach(button => {
      const productId = button.getAttribute('onclick').match(/'(\d+)'/)?.[1];
      if (wishlist.includes(productId)) {
        button.classList.add('active');
        button.querySelector('svg').style.fill = 'currentColor';
      }
    });
  });

  // Quick view functionality
  function openQuickView(productHandle) {
    // Implement quick view modal
    console.log('Opening quick view for:', productHandle);
  }

  // Load more products
  function loadMoreProducts() {
    const button = document.querySelector('.load-more-btn');
    button.innerHTML = 'LOADING...';
    button.classList.add('loading');

    // Simulate loading more products
    setTimeout(() => {
      button.innerHTML = `
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <path d="M8 12l2 2 4-4"/>
        </svg>
        LOAD MORE PRODUCTS
      `;
      button.classList.remove('loading');
    }, 1500);
  }
</script>

{% schema %}
{
  "name": "Featured Products V2",
  "tag": "section",
  "class": "premium-featured-section",
  "settings": [
    {
      "type": "header",
      "content": "Section Header"
    },
    {
      "type": "text",
      "id": "section_badge",
      "label": "Section Badge",
      "default": "BESTSELLERS"
    },
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "FEATURED PRODUCTS"
    },
    {
      "type": "textarea",
      "id": "section_subtitle",
      "label": "Section Subtitle",
      "default": "Discover our most popular premium supplements and gear, trusted by athletes worldwide"
    },
    {
      "type": "header",
      "content": "Product Settings"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "label": "Products to Show",
      "min": 4,
      "max": 20,
      "step": 4,
      "default": 8
    },
    {
      "type": "checkbox",
      "id": "show_filters",
      "label": "Show Filter Tabs",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_load_more",
      "label": "Show Load More Button",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Premium Featured Products V2"
    }
  ]
}
{% endschema %}
